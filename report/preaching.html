<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="manifest" href="manifest.json">
    
    <title id="pageTitle">My Data App</title>
    
    <style>
        :root { 
            --primary: #2563eb; --bg: #f8fafc; --card: #ffffff; 
            --text: #1e293b; --border: #cbd5e1; 
        }
        
        /* Dark Mode Colors */
        body.dark-mode { 
            --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --border: #334155; 
        }
        
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background: var(--bg); color: var(--text); margin: 0; padding: 20px;
            transition: background 0.3s, color 0.3s;
        }

        .container { width: 100%; max-width: 500px; margin: auto; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .editable-title { font-size: 1.5rem; font-weight: 800; border: none; background: transparent; color: var(--text); outline: none; }

        .card { background: var(--card); padding: 1.2rem; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { 
            width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid var(--border); 
            border-radius: 8px; background: var(--card); color: var(--text); box-sizing: border-box; 
        }
        
        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { padding: 12px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; color: white; }
        .btn-save { background: var(--primary); grid-column: span 2; }
        .btn-csv { background: #16a34a; }
        .btn-del { background: #ef4444; padding: 4px 8px; font-size: 0.7rem; }
        .btn-mode { background: #64748b; font-size: 0.8rem; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        td { padding: 12px 8px; border-bottom: 1px solid var(--border); }
        .hidden { display: none; }
    </style>
</head>
<body id="appBody">

<div class="container">
    <div class="header">
        <input type="text" id="siteName" class="editable-title" value="My Data App" oninput="saveTitle()">
        <button class="btn-mode" onclick="toggleDarkMode()">ðŸŒ™</button>
    </div>

     <div class="card">
        <div class="input-group">
            <input type="text" id="itemName" placeholder="Date (e.g. 20 monday)">
            <input type="text" id="itemNote" placeholder="Hours (e.g. 12)">
               <input type="text" id="itemNote" placeholder="B/s (e.g. 12)">
        </div>
            <button class="btn-save" onclick="addData()">Save Entry</button>
            <button class="btn-csv" onclick="downloadCSV()">Export</button>
            <button style="background:#64748b" onclick="if(confirm('Wipe all?')) { tableBody.innerHTML=''; saveData(); }">Clear</button>
        </div>
    </div>

    <input type="text" id="search" placeholder="Search..." onkeyup="filterTable()">
<table id="dataTable">
     <tr>
                <th>Date</th>
                <th>Hours</th>
                <th>B/s</th>
                <th>Time</th>
                <th style="width: 80px;">Action</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    // Toggle Dark Mode
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    function saveTitle() {
        localStorage.setItem('appTitle', document.getElementById('siteName').value);
    }

    function addData() {
        const name = document.getElementById('itemName').value;
        const note = document.getElementById('itemNote').value;
        if (!name) return;
        const time = new Date().toLocaleDateString([], {month:'short', day:'numeric'});
        renderRow(name, note, time);
        saveData();
        document.getElementById('itemName').value = '';
        document.getElementById('itemNote').value = '';
    }

    function renderRow(name, note, time) {
        const row = document.getElementById('tableBody').insertRow(0);
        row.innerHTML = `<td><b>${name}</b><br><small>${note}</small></td><td>${time}</td>
                         <td><button class="btn-del" onclick="this.parentElement.parentElement.remove();saveData();">X</button></td>`;
    }

    function saveTableToLocal() {
        const rows = [];
        document.querySelectorAll('#tableBody tr').forEach(tr => {
            const cells = tr.querySelectorAll('td');
            if(cells.length > 0) {
                rows.push({ name: cells[0].innerText, note: cells[1].innerText, note: cells[2].innerText, time: cells[3].innerText });
            }
        });
        localStorage.setItem('savedTableData', JSON.stringify(rows));
    }

    function filterTable() {
        const q = document.getElementById('search').value.toLowerCase();
        document.querySelectorAll('#tableBody tr').forEach(r => r.classList.toggle('hidden', !r.innerText.toLowerCase().includes(q)));
    }

    function downloadCSV() {
        let csv = 'Name,Note,Date\n';
        JSON.parse(localStorage.getItem('appData') || '[]').forEach(d => csv += `"${d.name}","${d.note}","${d.time}"\n`);
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([csv], {type:'text/csv'}));
        a.download = 'data.csv'; a.click();
    }

    // Init
    if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');
    const savedTitle = localStorage.getItem('appTitle');
    if (savedTitle) document.getElementById('siteName').value = savedTitle;
    JSON.parse(localStorage.getItem('appData') || '[]').reverse().forEach(d => renderRow(d.name, d.note, d.time));
 // 3. UI Logic
    function renderRow(name, note, time) {
        const tableBody = document.getElementById('tableBody');
        const row = tableBody.insertRow(0); // Most recent at top
        row.insertCell(0).innerText = name;
        row.insertCell(1).innerText = name
        row.insertCell(2).innerText = note;
        row.insertCell(3).innerText = time;
        
        const actionCell = row.insertCell(4);
        const delBtn = document.createElement('button');
        delBtn.innerText = 'Delete';
        delBtn.className = 'delete-btn';
        delBtn.onclick = function() {
            if(confirm('Delete this entry?')) {
                row.remove();
                saveTableToLocal();
            }
        };
        actionCell.appendChild(delBtn);
    }
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
</script>
</body>
</html>